new entry "Interrupt_SneakAttack"
type "InterruptData"
data "DisplayName" "hd8a8ad84g4f65g46fdgb04dg5b91daf7f291;1"
data "Description" "h23701712ge994g40bfga729g36dc38dc7c65;2"
data "ExtraDescription" "h76d95144gbf2eg4c33gae0bg9661d52519e1;1"
data "Icon" "Action_SneakAttack_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or IsRangedSpellAttack() or IsMeleeSpellAttack()) and not IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"
data "Properties" "IF(IsMeleeWeaponAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsRangedWeaponAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(SpellDamageTypeIs(DamageType.Cold)):DealDamage(LevelMapValue(SneakAttack),Cold,Magical);IF(SpellDamageTypeIs(DamageType.Fire)):DealDamage(LevelMapValue(SneakAttack),Fire,Magical);IF(SpellDamageTypeIs(DamageType.Thunder)):DealDamage(LevelMapValue(SneakAttack),Thunder,Magical);IF(SpellDamageTypeIs(DamageType.Lightning)):DealDamage(LevelMapValue(SneakAttack),Lightning,Magical);IF(SpellDamageTypeIs(DamageType.Acid)):DealDamage(LevelMapValue(SneakAttack),Acid,Magical);IF(SpellDamageTypeIs(DamageType.Poison)):DealDamage(LevelMapValue(SneakAttack),Poison,Magical);IF(SpellDamageTypeIs(DamageType.Radiant)):DealDamage(LevelMapValue(SneakAttack),Radiant,Magical);IF(SpellDamageTypeIs(DamageType.Necrotic)):DealDamage(LevelMapValue(SneakAttack),Necrotic,Magical);IF(SpellDamageTypeIs(DamageType.Psychic)):DealDamage(LevelMapValue(SneakAttack),Psychic,Magical);IF(SpellDamageTypeIs(DamageType.Force)):DealDamage(LevelMapValue(SneakAttack),Force,Magical);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4,Force,Magical);ApplyStatus(SELF,SNEAK_PENALTY,100,1)"
data "Cost" "SneakAttack_Charge:1"
data "Stack" "SneakAttack"
data "Cooldown" "OncePerTurn"
data "InterruptDefaultValue" "Enabled"
data "EnableCondition" "HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source) and (WieldingFinesseWeaponInSpecificHand(context.Source, false) or WieldingFinesseWeaponInSpecificHand(context.Source, true) or WieldingWeapon('Ammunition', false, true, context.Source) or SpellTypeIs(SpellType.Throw) or SpellTypeIs(SpellType.Target) or SpellTypeIs(SpellType.Zone) or SpellTypeIs(SpellType.Projectile) or SpellTypeIs(SpellType.Shout)) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')) and not HasStatus('SNEAK_PENALTY')"
data "EnableContext" "OnActionResourcesChanged;OnEquip"
new entry "Interrupt_SneakAttack_Critical"
type "InterruptData"
using "Interrupt_SneakAttack"
data "DisplayName" "haf81f97cgee6ag46cbg8749g814ddcccccec;1"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or IsRangedSpellAttack() or IsMeleeSpellAttack()) and IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"

new entry "Interrupt_SneakAttack_Penalty"
type "InterruptData"
data "DisplayName" "h6bd2fa533b4f4d12a87024fb32a916caeg9f;1"
data "Description" "h23701712ge994g40bfga729g36dc38dc7c65;2"
data "ExtraDescription" "h76d95144gbf2eg4c33gae0bg9661d52519e1;1"
data "Icon" "Action_SneakAttack_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or IsRangedSpellAttack() or IsMeleeSpellAttack()) and not IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"
data "Properties" "IF(IsMeleeWeaponAttack()):DealDamage(LevelMapValue(SneakAttack)/2, MainMeleeWeaponDamageType);IF(IsRangedWeaponAttack()):DealDamage(LevelMapValue(SneakAttack)/2, MainRangedWeaponDamageType);IF(SpellDamageTypeIs(DamageType.Cold)):DealDamage(LevelMapValue(SneakAttack)/2,Cold,Magical);IF(SpellDamageTypeIs(DamageType.Fire)):DealDamage(LevelMapValue(SneakAttack)/2,Fire,Magical);IF(SpellDamageTypeIs(DamageType.Thunder)):DealDamage(LevelMapValue(SneakAttack)/2,Thunder,Magical);IF(SpellDamageTypeIs(DamageType.Lightning)):DealDamage(LevelMapValue(SneakAttack)/2,Lightning,Magical);IF(SpellDamageTypeIs(DamageType.Acid)):DealDamage(LevelMapValue(SneakAttack)/2,Acid,Magical);IF(SpellDamageTypeIs(DamageType.Poison)):DealDamage(LevelMapValue(SneakAttack)/2,Poison,Magical);IF(SpellDamageTypeIs(DamageType.Radiant)):DealDamage(LevelMapValue(SneakAttack)/2,Radiant,Magical);IF(SpellDamageTypeIs(DamageType.Necrotic)):DealDamage(LevelMapValue(SneakAttack)/2,Necrotic,Magical);IF(SpellDamageTypeIs(DamageType.Psychic)):DealDamage(LevelMapValue(SneakAttack)/2,Psychic,Magical);IF(SpellDamageTypeIs(DamageType.Force)):DealDamage(LevelMapValue(SneakAttack)/2,Force,Magical);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4,Force,Magical);ApplyStatus(SELF,SNEAK_PENALTY,100,1)"
data "Cost" "SneakAttack_Charge:1"
data "Stack" "SneakAttack"
data "Cooldown" "OncePerTurn"
data "InterruptDefaultValue" "Enabled"
data "EnableCondition" "HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source) and (WieldingFinesseWeaponInSpecificHand(context.Source, false) or WieldingFinesseWeaponInSpecificHand(context.Source, true) or WieldingWeapon('Ammunition', false, true, context.Source) or SpellTypeIs(SpellType.Throw) or SpellTypeIs(SpellType.Target) or SpellTypeIs(SpellType.Zone) or SpellTypeIs(SpellType.Projectile) or SpellTypeIs(SpellType.Shout)) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')) and HasStatus('SNEAK_PENALTY')"
data "EnableContext" "OnActionResourcesChanged;OnEquip"

new entry "Interrupt_SneakAttack_Penalty_Critical"
type "InterruptData"
using "Interrupt_SneakAttack_Penalty"
data "DisplayName" "haf81f97cgee6ag46cbg8749g814ddcccccec;1"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or IsRangedSpellAttack() or IsMeleeSpellAttack()) and IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"